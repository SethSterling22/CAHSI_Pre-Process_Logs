# CAHSI_Pre-Process_Logs
Conversion of Logs to Different Quantification Methods in Graph-Based Exploration of Online Anomaly Detection

To change the directory names (using the package `rename`), you can use :
```bash
rename 's/ /_/g' *
```

---

## Project Structure

```text
CAHSI/
├── WUIL_Logs/                  # User and attacks Logs
|
├── CAHSI_Pre-Process_Logs/
│   ├── Converter/
│   │   ├── Results/            # CSVs and generated Scores
│   │   ├── prep_wuil.py        # Cleaning and injection Scripts
│   │   └── view_results.ipynb  # Visualization and metrics
|   |
│   ├── MIDAS/                  # C++ code with MIDAS algorithm
|   |
│   ├── SLADE/                  # code with SLADE algorithm
|   |
│   └── requirements.txt        # Python dependencies

```

---

## Execution guide:

### 1. Preparación del Entorno

Prepare Virtual Environment with the Python Dependencies.

```bash
cd ~/CAHSI/CAHSI_Pre-Process_Logs/Converter/

# Create virtual environment
python3 -m venv venv

# Activate virtual environment
source venv/bin/activate

# Install dependencies
pip install -r requirements.txt

```


---

### 2. Logs Pre-process (WUIL)

Turn WUIL `.txt` files to `.csv` compatibles with graphs (source, destination, time):

```bash
# Execute cleaning and injection script script
cd Converter

python3 prep_wuil.py

```

* **Input:** `../../WUIL_Logs/UserX/`
* **Output:** `/Results/userX_data.csv`, `userX_labels.csv`, `userX_meta.txt`

---

### 3. MIDAS Algorithm execution (C++)

Compile with the anomaly detection engine and process the data.

```bash
# Enter and clean previous compilations
cd ~/CAHSI_Pre-Process_Logs/MIDAS/

rm -rf build && mkdir -p build/release && cd build/release

# COnfigure and Compile
cmake ../.. -DCMAKE_BUILD_TYPE=Release
make Demo

# Execute for one user (Example: User1)
./Demo \
"../../../Converter/Results/user1_meta.txt" \
"../../../Converter/Results/user1_data.csv" \
"../../../Converter/Results/user1_labels.csv" \
"../../../Converter/Results/score_user1.txt"

```

---

### 4. Anlysis with Jupyter Notebook

Once `score_userX.txt` files were generated, you can open the notebook for presentation.

```bash
cd ~/CAHSI/CAHSI_Pre-Process_Logs/Converter/

jupyter notebook Analisis.ipynb
```

#### **Explanation of Jupyter Cells:**

1. **Load Results:** Import the *Ground Truth* (real labels) and the *Scores* generated by MIDAS.
2. **Metrics Calculation:** * **ROC-AUC:** It measures the model's ability to distinguish between normal access and an attack.
* **PRC (Precision-Recall):** Crucial for this project, since attacks are rare events (unbalanced classes).


3. **Comparative Visualization:** Generate a bar chart comparing the performance between the 3 users to identify in which one the model is most effective.

---

## Common Troubleshooting


* **Error: Permission Denied:** Execute `chmod +x Demo` in the build directory.
* **Error: File Not Found:** Make sure the directory **Results** exists before run the Python Script.
* **Kernel Died en Jupyter:** If the dataset is very large, make sure you don't have other heavy Python processes running on the server.

---